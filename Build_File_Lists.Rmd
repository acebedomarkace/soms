---
title: "Building Shakespeare Index"
author: Daniel Tanner
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
   toc: True
   toc_depth: 2
   toc_float: True
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE, fig.align='center', message = FALSE, warning = FALSE)
```

#Create play_table
The following creates `play_table.csv`. It assumes you have downloaded the Shakespeare Corpus available at http://lexically.net/wordsmith/support/shakespeare.html. 

Set `root.local` to "...\\ShakespearePlaysPlus\\TXT"

```{r}
root.local <- "C:/Users/DJT/Dropbox/workspace/SOM/soms/Shakespeare_txt"
```

```{r}
genres <- list.dirs(root.local, full.names = FALSE, recursive = FALSE)
play_table <- data.frame()
for (genre in genres){
  
  plays <- data.frame(list.files(path = paste(root.local, genre, sep = "/"), pattern = '.txt'), genre)
  play_table <- rbind(play_table, plays)
}

colnames(play_table)[1] <- "name"

root.git <- "https://raw.githubusercontent.com/clarkdatalabs/soms/master/Shakespeare_txt"

#make play paths
play_table <- within(play_table, path <- apply(as.matrix(paste(root.git, genre, name, sep = "/" )),1,URLencode))

#strip .txt extension from play names
play_table$name <- gsub('.txt','', play_table$name)
```


```{r, include=FALSE}
write.csv(play_table, file = "play_table.csv", row.names = FALSE)
```


Example of reading text file contents from GitHub:
```{r}
library("readr")
playText <- read_file(as.character(play_table[1,"path"]), locale(encoding = "UTF-16"))
```

#Read in play text from index table

##get play index table
```{r}
library("RCurl")
play_table <- read.csv(text=getURL("https://raw.githubusercontent.com/clarkdatalabs/soms/master/Shakespeare_txt/play_table.csv"), sep=",", header=T, check.names = FALSE)
```

##Read in play text
```{r}
library("readr")
for (row in row.names(play_table)){
  play_table[row, "text"] <- read_file(as.character(play_table[row,"path"]) , locale(encoding = "UTF-16"))
}
remove(row)
```





#Create character_table

```{r}
#initialize table
character_table <- data.frame(character=character(),
                              play=character(),
                              genre=character(),
                              text=character())

#populate character names
for (play in play_table$name){
  genre <- play_table[play_table$name == play, "genre"]
  characters <- data.frame(list.files(path = paste(root.local, genre, paste(play, "_characters", sep = ""), sep = "/")))
  
  character_table <- rbind(character_table, cbind(characters, play, genre))
}

colnames(character_table)[1] <- "character"

#make play paths
root.git <- "https://raw.githubusercontent.com/clarkdatalabs/soms/master/Shakespeare_txt"

character_table <- within(character_table, path <- apply(as.matrix(paste(root.git, genre, paste(play,'_characters', sep = ""), character, sep = "/" )),1,URLencode))

#strip .txt extension from character names
character_table$character <- gsub('.txt','', character_table$character)

```

```{r, include=FALSE}
write.csv(character_table, file = "character_table.csv", row.names = FALSE)
```

Example of reading text file contents from GitHub:
```{r}
library("readr")
playText <- read_file(as.character(character_table[238,"path"]), locale(encoding = "UTF-16"))
```

```{r}
library("readr")
playText <- read_file(URLdecode(character_table[238,"path"]), locale(encoding = "UTF-16"))
```
